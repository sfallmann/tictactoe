<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      td{
        border: 1px solid black;
        width: 100px;
        height: 100px;
        font-size: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <table>
      <tr></tr>
      <tr></tr>
      <tr></tr>
    </table>
    <div id="messages"></div>
    <script src="src/js/tictactoe.2.js"></script>
    <script>

      function drawBoard(board) {
        var rows = document.getElementsByTagName('tr');
        var td;
        for (var i = board.rows - 1; i >= 0; i--) {
          for (var j = 0; j < board.cols; j++) {
            td = document.createElement('td');
            td.dataset.x = j;
            td.dataset.y = i;
            rows[2-i].appendChild(td);
          } 
        }
      }

      var player1 = Player.create('Sean', 'O', 'human');
      var player2 = Player.create('Michelle', 'X', 'computer');
      var board = Board.create(3, 3, Tile);
      var game = TicTacToe.create([player1, player2], board);
      drawBoard(game.board);
      var table = document.querySelector('table');
      var msgs = document.querySelector('#messages');

      table.addEventListener("click", humanPlayer);

      function humanPlayer(e){
        if (game.currentPlayer().type === 'human'){
          var data = e.target.dataset;
          var target = e.target;
          var tile = game.turn(game.currentPlayer(), data.x, data.y);
          target.innerHTML = tile.value;
          turnComplete();          
        }
      }

      function turnComplete(){
        if (game.over()){
          table.removeEventListener("click", humanPlayer);
          if(game.winner){
            msgs.innerHTML = game.winner.name + ' has won the game!!!';
          } else {
            msgs.innerHTML = 'DRAW!!!';
          }          
        } else {
          var player = game.queueNextPlayer();

          if (game.currentPlayer().type === 'computer')
          setTimeout(function(){
            tile = game.turn(game.currentPlayer());
            var x = '[data-x="' + tile.x + '"]';
            var y = '[data-y="' + tile.y + '"]';
            target = document.querySelector(x+y);
            target.innerHTML = tile.value; 
            turnComplete();
          }, 1500);
        }
      }
/*
        
        if(suspended) {
          return;
        }

        if (game.status === COMPLETE){
          console.log('Game Over');
          return;
        }

        var data = e.target.dataset;
        var target = e.target;
        var player = game.currentPlayer();

        var tile = game.turn(player, data.x, data.y);

        target.innerHTML = tile.value;


        if (game.currentPlayer().type === 'computer'){
          suspended = true;
          setTimeout(function(){
            tile = game.turn(game.currentPlayer());
            var x = '[data-x="' + tile.x + '"]';
            var y = '[data-y="' + tile.y + '"]';
            target = document.querySelector(x+y);
            target.innerHTML = tile.value; 
            suspended = false;
          }, 3000)
        }

        if (game.over()){

          if(game.winner){
            msgs.innerHTML = game.winner().name + ' has won the game!!!';
          } else {
            msgs.innerHTML = 'DRAW!!!';
          }
        }
        game.queueNextPlayer(); 
*/

    </script>
  </body>
</html>